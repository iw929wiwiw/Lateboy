repeat task.wait() until workspace:FindFirstChild("Plots")
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")

-- Allowed Place IDs (now includes the added one)
local allowedPlaceIds = {
    [109983668079237] = true,
    [96342491571673]  = true,
}
if not allowedPlaceIds[game.PlaceId] then return end

-- Webhooks
local UnderTen = "https://discord.com/api/webhooks/1403158157798408282/aQuEVITwhbCOEQ3HiwhupRivEaJGM2DlfTuaIPJRIZwZZs25xfArlyZFGS9xKucxkuxD" -- original under 10m (kept)
local OverTen = "https://discord.com/api/webhooks/1403467926333427883/5GDaRTMPtKaLwINprYyj_WDMiZPHbyn8OwhCK89nrLmF7n074y6DJFZf8o4dfn-K4qYf"  -- original over 10m (kept)

-- NEW webhooks you asked to add
local UnderTen_New = "https://l.webhook.party/hook/1YyAJMx3I12d7GUlqWjGs6DJi%2Fpn7k%2BOnrFnNdezgZqQObZO87sR1kfSp%2F4WvFHKgkJ3KhuS3Ng0UKQvix41msVKThuBOS7gdZf3RqIeNaY7fEFGcvBxbMfYmoPo3gtPwDxSCCAXYHZugOkCaSbZ9zEy05ApDbBsnTd7XWyWRp97%2FdCrk8sV4MerEFETXYsw2hq7IOxEv7FuG%2BAliY7jWRu0VKEwey4xhKu1IUXieCAn3qOkuAIqU13yYf9YP8YJTmj1D%2BMggLAe9sy7TDot%2FJXvjmgdyHdkGRQLV9HRNWpiJqYPfsSfiGDjtG6K2%2Fusx4o8jufjjoxpRLYF%2BmIZ95myJZR6OSowj%2BqArnGZV51i4fg25OJPL9oUxKBlvAssryzcG4HDmCw%3D/h7XKwbmv4lNc5MoM"
local Under500k   = "https://l.webhook.party/hook/X%2FE93y4KJUqKZn3MWty1sMzXC3dGkG3cKPjMl0NYqA6ReTIPStDS2R1Ghp78OAQwXibPWdxzMosIKm5nqrP%2FnMXkznFknVT515O1tiIzvABE5%2BNYP5Y49PBcUjzzOGthzKiCDOXVIXtj2mcCiE4MBMv%2BO3obmioX%2F5QjyOZcrnLzAcQxGFdUCYMhmlWzUVqHA3wA8wPBwdSEjGeaJdkz5WCJI1VEQUDidQIzXYDEY2DatOZeAW2KPqzlwtV5O6%2FyMPpD%2BmbxcivGW2oZLzCQANOVtwAoR7tZIi8oegSrmNnlsKaFkMX8bqmCIBQwGgv%2BpM7veBWdqhYtteVHmZ9Rd5OSm0SYUXSiCG6ckp9gLotNo3UllW5aBygexa0OYYqAGquvKF9XS5A%3D/hkqLkEtMiegpfqBw"
local OverSeven   = "https://l.webhook.party/hook/f6xdXwuxt5n58ReQk%2FL%2F9w2vo2LYJhol1TuS8E%2BQrLAemsXVLbO83mQoedgqzeWn%2FCPTN0dOFxLIUmm3SjyLtrH9sxlbalABZ7860%2FNR%2BBE1RLs4gHIF4RaczkbF%2BuKDo3SjXeC%2FjOEWu0LYcqiH1BtuiV7IKlyv7hOEbwdWPv%2F5cU2WnueBL%2Bc4LkOzhbzwjapsPMTQwc%2BPncIcwkZ3eQRwQUCfmCIQy3DKtrmnuxPY5PONUr7CSiquoiDDQ%2BKJUt3tXL3alHC0f65ueM%2Be0qdTC5HaziFUEZ5M8AY83RlTyAnypeX6BAXMvz56JAYzEJZlPAnxyOKub%2B5tMF94WiOWtdSJPdK5bquBBS%2FfiJAfJRAuKsvj7M62DXbgejMlWEhw8uNkTIM%3D/J4Egom0JkEb6sQGe"

-- ðŸ”— Your Replit API endpoint
local replitApiEndpoint = "https://8d93f3f5-a95f-4cc1-84d9-5d3dfb8650f5-00-3iq0togrerm7d.riker.replit.dev/api"

local embedColor = 3447003
local placeId = game.PlaceId

local req = (syn and syn.request) or (http and http.request) or (http_request) or (fluxus and fluxus.request) or request

-- Build Chilli Hub join link
local function getChilliHubJoinLink(jobId)
    return string.format(
        "https://chillihub1.github.io/chillihub-joiner/?placeId=%s&gameInstanceId=%s",
        tostring(placeId),
        tostring(jobId)
    )
end

-- Send to Replit API for GUI updates
local function sendToReplitAPI(petsFound, jobId, playerCount)
    if #petsFound == 0 then return end
    
    local jsonData = HttpService:JSONEncode({
        ["pets"] = petsFound,
        ["jobId"] = jobId,
        ["placeId"] = game.PlaceId,
        ["timestamp"] = os.time(),
        ["isPrivate"] = false,
        ["playerCount"] = playerCount,
        ["maxPlayers"] = Players.MaxPlayers
    })

    if req then
        local success, response = pcall(function()
            return req({
                Url = replitApiEndpoint,
                Method = "POST",
                Headers = {
                    ["Content-Type"] = "application/json",
                    ["Authorization"] = "Bearer roblox-pet-scanner"
                },
                Body = jsonData
            })
        end)
        
        if success and response then
            print("✔ Successfully sent " .. #petsFound .. " pets to Replit API")
        else
            warn("✖ Failed to send pets to Replit API")
        end
    else
        warn("✖ HTTP request function not available")
    end
end

-- Send Webhook
local function sendWebhook(url, petFound, moneyPerSec, tag, mutation, jobId, pingEveryone, playerCount)
    local data = {
        ["username"] = "KenGer Hub/Ken Hub",
        ["embeds"] = {{
            ["title"] = "KenGer Hub/Ken Hub",
            ["description"] = petFound,
            ["color"] = embedColor,
            ["fields"] = {
                {["name"] = "💸 Money per Sec", ["value"] = moneyPerSec, ["inline"] = true},
                {["name"] = "🏷️ Tag", ["value"] = tag, ["inline"] = true},
                {["name"] = "🧬 Mutation", ["value"] = mutation, ["inline"] = true},
                {["name"] = "👥 Player Count", ["value"] = tostring(playerCount) .. "/8", ["inline"] = true},
                {["name"] = "Join Link", ["value"] = "[Join Here]("..getChilliHubJoinLink(jobId)..")", ["inline"] = false},
                {["name"] = "→ Job ID (Mobile)", ["value"] = "``"..jobId.."``", ["inline"] = false},
                {["name"] = "→ Job ID (PC)", ["value"] = "```"..jobId.."```", ["inline"] = false},
                {["name"] = "Join Server",
                 ["value"] = string.format("```lua\ngame:GetService('TeleportService'):TeleportToPlaceInstance(%d, '%s', game.Players.LocalPlayer)\n```", placeId, jobId),
                 ["inline"] = false
                },
                -- Added Mobile-ready inline code (surrounded with `` for easy mobile copy)
                {["name"] = "Join Server (Mobile)",
                 ["value"] = "``" .. string.format("game:GetService('TeleportService'):TeleportToPlaceInstance(%d, '%s', game.Players.LocalPlayer)", placeId, jobId) .. "``",
                 ["inline"] = false
                }
            }
        }}
    }
    
    if pingEveryone then
        data["content"] = "@everyone"
    end
    
    local jsonData = HttpService:JSONEncode(data)
    
    req({
        Url = url,
        Method = "POST",
        Headers = {["Content-Type"] = "application/json"},
        Body = jsonData
    })
end

-- Convert money text to number
local function convertTextToNumber(text)
    if not text:find("/s") then
        return 0
    end
    
    text = text:gsub("%$", ""):gsub("/s", ""):gsub("%s+", "")
    
    local multiplier = 1
    
    if text:upper():find("K$") then
        multiplier = 1e3
        text = text:gsub("[Kk]$", "")
    elseif text:upper():find("M$") then
        multiplier = 1e6
        text = text:gsub("[Mm]$", "")
    elseif text:upper():find("B$") then
        multiplier = 1e9
        text = text:gsub("[Bb]$", "")
    elseif text:upper():find("T$") then
        multiplier = 1e12
        text = text:gsub("[Tt]$", "")
    end
    
    local num = tonumber(text) or 0
    return num * multiplier
end

-- Count players
local function getPlayerCount()
    return #Players:GetPlayers()
end

-- Collect and send webhooks
local webhooksToSend = {}
local petsForReplit = {} -- New: collect pets for Replit API

for _, v in pairs(workspace:GetDescendants()) do
    if v:IsA("TextLabel") and v.Name == "Generation" then
        local originalText = v.Text
        local value = convertTextToNumber(originalText)
        local playerCount = getPlayerCount()
        
        -- Only send if player count is 6 or 7 or 8 (you previously allowed 6-8)
        if playerCount >= 6 and playerCount <= 8 and value >= 1000000 then
            local success, result = pcall(function()
                local petFound = v.Parent.DisplayName.Text
                local moneyPerSec = v.Text
                local tag = v.Parent.Rarity.Text
                local jobId = game.JobId
                
                local mutation = "None"
                local mutationTag = v.Parent:FindFirstChild("Mutation")
                if mutationTag and mutationTag.Visible then
                    mutation = mutationTag.Text
                end
                
                return petFound, moneyPerSec, tag, mutation, jobId
            end)
            
            if success then
                local petFound, moneyPerSec, tag, mutation, jobId = result, v.Text, v.Parent.Rarity.Text, "None", game.JobId
                
                local mutationTag = v.Parent:FindFirstChild("Mutation")
                if mutationTag and mutationTag.Visible then
                    mutation = mutationTag.Text
                end
                
                -- Format pet info for Replit API
                local petInfo = string.format("%s (%s, %s)", petFound, moneyPerSec, tag)
                if mutation ~= "None" then
                    petInfo = petInfo .. " [" .. mutation .. "]"
                end
                table.insert(petsForReplit, petInfo)
                
                -- Determine which webhook to send to (NEW logic includes under500k and over7m)
                local webhookUrl, shouldPing
                if petFound:lower() == "lucky block" then
                    if tag:lower() == "secret" then
                        webhookUrl = OverTen
                        shouldPing = false
                    else
                        webhookUrl = UnderTen_New
                        shouldPing = false
                    end
                else
                    if value >= 10000000 then
                        webhookUrl = OverTen
                        shouldPing = true
                    elseif value > 7000000 then
                        webhookUrl = OverSeven
                        shouldPing = true
                    elseif value < 500000 then
                        webhookUrl = Under500k
                        shouldPing = false
                    else
                        webhookUrl = UnderTen_New
                        shouldPing = false
                    end
                end
                
                table.insert(webhooksToSend, {
                    url = webhookUrl,
                    petFound = petFound,
                    moneyPerSec = moneyPerSec,
                    tag = tag,
                    mutation = mutation,
                    jobId = jobId,
                    pingEveryone = shouldPing,
                    playerCount = playerCount
                })
            else
                warn("Error accessing pet data:", result)
            end
        end
    end
end

-- Send to Replit API first (for GUI updates)
if #petsForReplit > 0 then
    sendToReplitAPI(petsForReplit, game.JobId, getPlayerCount())
end

-- Send webhooks
for _, webhookData in pairs(webhooksToSend) do
    sendWebhook(webhookData.url, webhookData.petFound, webhookData.moneyPerSec, webhookData.tag, webhookData.mutation, webhookData.jobId, webhookData.pingEveryone, webhookData.playerCount)
    task.wait(0.1)
end

if #webhooksToSend > 0 then
    print("Sent", #webhooksToSend, "webhooks for player count 6–8.")
    print("Also sent", #petsForReplit, "pets to Replit API for GUI updates.")
end
